<!DOCTYPE html>
<html lang="ar" dir="rtl">
<meta name="description" content="أداة موسيقية متكاملة لحساب الانتقال النغمي بين السلالم والمقامات، اكتشاف السلم النسبي، وموسوعة شاملة للمقامات الشرقية وخصائصها.">
<meta name="keywords" content="موسيقى, مقامات, سلالم, نظريات موسيقية, تحليل موسيقي, ربع تون, حجاز, راست, بياتي, نهاوند, transpose, relative minor">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المساعد الموسيقي الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://css.gg/css?=|music" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        .output-box {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 100px;
            transition: all 0.3s ease;
        }
        select, .output-box, button {
            -webkit-tap-highlight-color: transparent;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
        }
        .ai-output h4 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #93c5fd; /* text-blue-300 */
            margin-bottom: 0.5rem;
        }
         .ai-output p {
            font-size: 1.125rem; /* text-lg */
            line-height: 1.8;
        }
        /* Style for the quarter tone section */
        .ai-output .quarter-tone-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #5eead4; /* text-teal-300 */
            margin-top: 1rem;
            margin-bottom: 0.25rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto p-4 sm:p-6 max-w-4xl">

        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-400 flex items-center justify-center gap-3">
                <i class="gg-music"></i>
                <span>أداة السلالم والمقامات</span>
            </h1>
            <p class="text-gray-400 mt-2 text-lg">تحويل بين السلالم الغربية والمقامات الشرقية بسهولة</p>
        </header>

        <main class="space-y-8">
            <!-- Transpose Calculator -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-5 text-center text-blue-300 border-b-2 border-gray-700 pb-3">حاسبة الانتقال النغمي (Transpose)</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <!-- "FROM" SECTION -->
                    <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-xl font-semibold text-center mb-4 text-gray-300">من:</h3>
                        <div class="grid-container">
                            <div>
                                <label for="from-type" class="block mb-2 text-md font-medium text-gray-400">النوع</label>
                                <select id="from-type" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                            </div>
                            <div>
                                <label for="from-key" class="block mb-2 text-md font-medium text-gray-400">الدرجة</label>
                                <select id="from-key" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                            </div>
                        </div>
                    </div>
                     <!-- "TO" SECTION -->
                    <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-xl font-semibold text-center mb-4 text-gray-300">إلى:</h3>
                        <div class="grid-container">
                             <div>
                                <label for="to-type" class="block mb-2 text-md font-medium text-gray-400">النوع</label>
                                <select id="to-type" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                            </div>
                            <div>
                                <label for="to-key" class="block mb-2 text-md font-medium text-gray-400">الدرجة</label>
                                <select id="to-key" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="transpose-result" class="output-box mt-6 p-4 rounded-lg text-center flex items-center justify-center"></div>
            </div>

            <!-- Relative Scale Finder -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-5 text-center text-blue-300 border-b-2 border-gray-700 pb-3">مكتشف السلم النسبي (Major/minor)</h2>
                <div class="flex justify-center mb-4">
                    <div class="inline-flex rounded-lg bg-gray-700 p-1">
                        <button id="major-mode-btn" class="px-6 py-2 rounded-md text-lg font-semibold bg-blue-500 text-white">كبير (Major)</button>
                        <button id="minor-mode-btn" class="px-6 py-2 rounded-md text-lg font-semibold text-gray-300">صغير (Minor)</button>
                    </div>
                </div>
                <select id="relative-scale-select" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                <div id="relative-result" class="output-box mt-6 p-4 rounded-lg text-center flex items-center justify-center"></div>
            </div>

            <!-- OFFLINE AI Assistant -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border-2 border-indigo-500/50">
                <h2 class="text-2xl font-semibold mb-5 text-center text-indigo-300 border-b-2 border-gray-700 pb-3">✨ موسوعة المقامات والسلالم</h2>
                <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700 max-w-lg mx-auto">
                     <div class="grid-container">
                        <div>
                            <label for="ai-type" class="block mb-2 text-md font-medium text-gray-400">النوع</label>
                            <select id="ai-type" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                        </div>
                        <div>
                            <label for="ai-key" class="block mb-2 text-md font-medium text-gray-400">الدرجة</label>
                            <select id="ai-key" class="w-full bg-gray-700 text-white border-2 border-gray-600 rounded-lg p-3 text-lg focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"></select>
                        </div>
                    </div>
                </div>
                <div id="ai-result" class="output-box mt-6 p-4 rounded-lg">
                    <p class="text-gray-400 text-center">اختر مقامًا أو سلمًا لعرض معلومات عنه.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- OFFLINE DATA ---
        const offlineData = {
            "Major": {
                description: "السلم الكبير هو أساس الموسيقى الغربية، يتميز بطابعه السعيد، المشرق والبطولي. هو السلم الأكثر شيوعًا في أغاني البوب والموسيقى الكلاسيكية.",
            },
            "minor": {
                description: "السلم الصغير (الهارموني) يتميز بطابعه الحزين، الدرامي، والكلاسيكي. يستخدم بكثرة في الموسيقى التي تعبر عن مشاعر الشوق والعمق.",
            },
            "راست": {
                description: "مقام الراست هو 'أبو المقامات' ويتميز بالفخامة والوقار والجدية. هو مقام شرقي أصيل يعبر عن الأصالة والقوة.",
                quarterToneNote: "تتميز الدرجة الثالثة (مثل مي نصف بيمول) والسابعة (مثل سي نصف بيمول) بوجود الربع تون."
            },
            "بياتي": {
                description: "مقام البياتي يعبر عن الشجن والحزن الممزوج بالفرح. له طابع ريفي وشعبي أصيل، ويدخل في الكثير من الأغاني العاطفية والمواويل.",
                quarterToneNote: "تتميز الدرجة الثانية (مثل ري نصف بيمول) بوجود الربع تون، وهي التي تعطيه طابعه الشجي المميز."
            },
            "حجاز": {
                description: "مقام الحجاز له طابع شرقي صحراوي واضح جدًا. يوحي بالروحانية، الشوق، والحنين. أبعاده المميزة (الثانية الزائدة) تجعله سهل التعرف عليه.",
            },
            "نهاوند": {
                description: "مقام النهاوند هو المقابل الشرقي للسلم الصغير (الماينور). يتميز بطابعه الرومانسي، الحالم، والعاطفي الجياش.",
            },
            "كرد": {
                description: "مقام الكرد يشبه في طابعه مقام النهاوند لكنه أكثر بساطة وعاطفية مباشرة. يعبر عن مشاعر هادئة، حزينة أو حالمة.",
            },
            "عجم": {
                description: "مقام العجم هو المقابل الشرقي للسلم الكبير (الميجور). طابعه هو الفرح، الإشراق، والوضوح، ويستخدم في الأناشيد الوطنية والأغاني المبهجة.",
            },
            "صبا": {
                description: "مقام الصبا هو أكثر المقامات حزنًا وأسى. يعبر عن ألم الفراق والأسى العميق. له طابع خاص جدًا ومؤثر للغاية.",
                quarterToneNote: "يتميز بأبعاده الدقيقة والخاصة التي لا تعتمد على الربع تون الثابت، مما يعطيه طابعه الحزين الفريد."
            },
             "سيكاه": {
                description: "مقام السيكاه هو مقام يوحي بالطرب الأصيل والتمهل. له طابع مريح ومستقر، وكثيرًا ما يستخدم في الموشحات والقصائد.",
                quarterToneNote: "تتميز درجة ركوزه نفسها بوجود ربع تون (مثل المي نصف بيمول)."
            }
        };

        const notes = [
            { name: 'C', value: 0 }, { name: 'C# / Db', value: 1 }, { name: 'D', value: 2 },
            { name: 'D# / Eb', value: 3 }, { name: 'E', value: 4 }, { name: 'F', value: 5 },
            { name: 'F# / Gb', value: 6 }, { name: 'G', value: 7 }, { name: 'G# / Ab', value: 8 },
            { name: 'A', value: 9 }, { name: 'A# / Bb', value: 10 }, { name: 'B', value: 11 }
        ];

        const scaleTypes = {
            "سلالم غربية": [ { name: "Major" }, { name: "minor" }, ],
            "مقامات شرقية": [ { name: "راست" }, { name: "بياتي" }, { name: "حجاز" }, { name: "نهاوند" }, { name: "كرد" }, { name: "عجم" }, { name: "صبا" }, { name: "سيكاه" } ]
        };
        
        // --- DOM Elements ---
        const fromTypeSelect = document.getElementById('from-type');
        const fromKeySelect = document.getElementById('from-key');
        const toTypeSelect = document.getElementById('to-type');
        const toKeySelect = document.getElementById('to-key');
        const transposeResultDiv = document.getElementById('transpose-result');
        
        // AI elements
        const aiTypeSelect = document.getElementById('ai-type');
        const aiKeySelect = document.getElementById('ai-key');
        const aiResultDiv = document.getElementById('ai-result');
        
        // Relative finder elements
        const relativeScaleSelect = document.getElementById('relative-scale-select');
        const relativeResultDiv = document.getElementById('relative-result');
        const majorModeBtn = document.getElementById('major-mode-btn');
        const minorModeBtn = document.getElementById('minor-mode-btn');
        let currentRelativeMode = 'major';

        function displayAiInfo() {
            const scaleType = aiTypeSelect.value;
            const keyName = aiKeySelect.options[aiKeySelect.selectedIndex].text;
            const data = offlineData[scaleType];
            const fullName = getFullName(scaleType, keyName);

            if (data) {
                let quarterToneInfo = ''; // Start with an empty string
                if (data.quarterToneNote) {
                    quarterToneInfo = `
                        <h5 class="quarter-tone-title">الربع تون (التشريق):</h5>
                        <p>${data.quarterToneNote}</p>
                    `;
                }

                aiResultDiv.innerHTML = `
                    <div class="text-right w-full ai-output">
                        <h4>معلومات عن: ${fullName}</h4>
                        <p>${data.description}</p>
                        ${quarterToneInfo}
                    </div>
                `;
            } else {
                aiResultDiv.innerHTML = `<p class="text-gray-400 text-center">لا توجد معلومات متاحة حاليًا.</p>`;
            }
        }

        function populateTypeSelect(selectElement) {
            selectElement.innerHTML = '';
            for (const groupName in scaleTypes) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = groupName;
                scaleTypes[groupName].forEach(type => {
                    const option = document.createElement('option');
                    option.value = type.name;
                    option.textContent = type.name;
                    optgroup.appendChild(option);
                });
                selectElement.appendChild(optgroup);
            }
        }

        function populateKeySelect(selectElement) {
            selectElement.innerHTML = '';
            notes.forEach(note => {
                const option = document.createElement('option');
                option.value = note.value;
                option.textContent = note.name;
                selectElement.appendChild(option);
            });
        }
        
        function getFullName(typeText, keyText){
             return `${typeText.startsWith("مقام") ? 'مقام' : 'سلم'} ${typeText} على ${keyText}`;
        }

        function calculateTranspose() {
            const fromKeyValue = parseInt(fromKeySelect.value);
            const toKeyValue = parseInt(toKeySelect.value);
            const fromTypeText = fromTypeSelect.options[fromTypeSelect.selectedIndex].text;
            const fromKeyText = fromKeySelect.options[fromKeySelect.selectedIndex].text;
            const toTypeText = toTypeSelect.options[toTypeSelect.selectedIndex].text;
            const toKeyText = toKeySelect.options[toKeySelect.selectedIndex].text;

            let difference = toKeyValue - fromKeyValue;
            
            const semitonesUp = difference >= 0 ? difference : difference + 12;
            const semitonesDown = difference <= 0 ? -difference : 12 - difference;

            const fromFullName = getFullName(fromTypeText, fromKeyText);
            const toFullName = getFullName(toTypeText, toKeyText);

            transposeResultDiv.innerHTML = `
                <div class="text-xl">
                    <p class="mb-2">للإنتقال من <strong class="text-blue-300">${fromFullName}</strong> إلى <strong class="text-blue-300">${toFullName}</strong>:</p>
                    <div class="flex flex-col sm:flex-row justify-center gap-4 text-2xl font-bold mt-4">
                        <span class="bg-green-500 bg-opacity-80 text-white px-4 py-2 rounded-lg">▲ ${semitonesUp} نصف تون صعوداً</span>
                        <span class="bg-red-500 bg-opacity-80 text-white px-4 py-2 rounded-lg">▼ ${semitonesDown} نصف تون هبوطاً</span>
                    </div>
                </div>
            `;
        }
        
        const westernScalesForRelative = {
            major: notes.map(n => ({ name: `${n.name} Major`, value: n.value })),
            minor: notes.map(n => ({ name: `${n.name} minor`, value: n.value }))
        };

        function populateSimpleSelect(selectElement, scaleArray) {
            selectElement.innerHTML = '';
            scaleArray.forEach(scale => {
                const option = document.createElement('option');
                option.value = scale.value;
                option.textContent = scale.name;
                selectElement.appendChild(option);
            });
        }

        function findRelative() {
            const selectedValue = parseInt(relativeScaleSelect.value);
            let relativeValue, relativeName, originalName;
            originalName = relativeScaleSelect.options[relativeScaleSelect.selectedIndex].text;

            if (currentRelativeMode === 'major') {
                relativeValue = (selectedValue - 3 + 12) % 12;
                relativeName = westernScalesForRelative.minor.find(s => s.value === relativeValue).name;
            } else {
                relativeValue = (selectedValue + 3) % 12;
                relativeName = westernScalesForRelative.major.find(s => s.value === relativeValue).name;
            }
            
            relativeResultDiv.innerHTML = `
                <div class="text-xl">
                    <p>السلم النسبي لـ <strong class="text-blue-300">${originalName}</strong></p>
                    <p class="text-3xl font-bold mt-2 text-green-400">${relativeName}</p>
                </div>
            `;
        }

        function switchRelativeMode(mode) {
            currentRelativeMode = mode;
            if (mode === 'major') {
                majorModeBtn.classList.add('bg-blue-500', 'text-white');
                majorModeBtn.classList.remove('text-gray-300');
                minorModeBtn.classList.remove('bg-blue-500', 'text-white');
                minorModeBtn.classList.add('text-gray-300');
            } else {
                minorModeBtn.classList.add('bg-blue-500', 'text-white');
                minorModeBtn.classList.remove('text-gray-300');
                majorModeBtn.classList.remove('bg-blue-500', 'text-white');
                majorModeBtn.classList.add('text-gray-300');
            }
            updateRelativeSelect();
        }

        function updateRelativeSelect() {
            if (currentRelativeMode === 'major') {
                populateSimpleSelect(relativeScaleSelect, westernScalesForRelative.major);
            } else {
                populateSimpleSelect(relativeScaleSelect, westernScalesForRelative.minor);
            }
            findRelative();
        }

        function setupUI() {
            // Transpose selects
            populateTypeSelect(fromTypeSelect);
            populateTypeSelect(toTypeSelect);
            populateKeySelect(fromKeySelect);
            populateKeySelect(toKeySelect);
            [fromTypeSelect, fromKeySelect, toTypeSelect, toKeySelect].forEach(sel => {
                sel.addEventListener('change', calculateTranspose);
            });
            calculateTranspose();

            // AI selects
            populateTypeSelect(aiTypeSelect);
            populateKeySelect(aiKeySelect);
            [aiTypeSelect, aiKeySelect].forEach(sel => {
                sel.addEventListener('change', displayAiInfo);
            });
            displayAiInfo();

            // Relative scale finder
            updateRelativeSelect();
            relativeScaleSelect.addEventListener('change', findRelative);
            majorModeBtn.addEventListener('click', () => switchRelativeMode('major'));
            minorModeBtn.addEventListener('click', () => switchRelativeMode('minor'));
        }

        document.addEventListener('DOMContentLoaded', setupUI);

    </script>
</body>
</html>
